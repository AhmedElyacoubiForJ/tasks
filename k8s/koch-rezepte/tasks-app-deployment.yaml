# ğŸ§‘â€ğŸ³ Schritt-fÃ¼r-Schritt: App-Deployment starten

# 1ï¸âƒ£ Namespace anlegen (falls noch nicht vorhanden)
# kubectl create namespace dev

# 2ï¸âƒ£ App-Deployment anwenden
# kubectl apply -f ./k8s/koch-rezepte/tasks-app-deployment.yaml

# ğŸ” Danach prÃ¼fen wir:
# ğŸ§‘â€ğŸ³ NÃ¤chste Schritte am Herd

# Pod-Status prÃ¼fen
# kubectl get pods -n dev

# Logs anschauen (Startverhalten & DB-Verbindung)
# kubectl logs <pod-name> -n dev

# In den Container springen
# kubectl exec -it <pod-name> -n dev -- sh

# ğŸ§¼ Was tun, wenn du frisch starten willst?

# 1. Deployment lÃ¶schen
# kubectl delete deployment tasks-app -n dev

# 2. Pod manuell lÃ¶schen (falls nÃ¶tig)
# kubectl delete pod <pod-name> -n dev

# ğŸ” Bonus: Deployment-Status prÃ¼fen
# kubectl get deployments -n dev

# ğŸ” Dann neu anwenden:
# kubectl apply -f ./k8s/koch-rezepte/tasks-app-deployment.yaml

# voraussetzung image app vorhanden in Minikube-Docker
#
# Wenn Image nicht in Minikube-docker ist "eval $(minikube docker-env)"
# docker build -t tasks-app:dev -f Dockerfile.minikube .
#
# â€sanftâ€œ neustarten fÃ¼r alle FÃ¤lle
# kubectl rollout restart deployment tasks-app -n dev

apiVersion: apps/v1
kind: Deployment
metadata:
  name: tasks-app
  namespace: dev
  labels:
    app: tasks-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tasks-app
  template:
    metadata:
      labels:
        app: tasks-app
    spec:
      containers:
        - name: tasks-app
          image: tasks-app:dev # ğŸ§‚ Hier kommt dein App-Image rein
          ports:
            - containerPort: 8080 # ğŸ”¢ Port, auf dem die App lauscht
          env:
            # ğŸ§  Datenbankverbindung fÃ¼r Spring Boot
            - name: DB_HOST
              value: postgres-dev # ğŸ”— Service-Name der Datenbank
            - name: DB_PORT
              value: "5432"
            - name: DB_NAME
              value: tasks_dev_db
            - name: APP_DB_USER
              value: dev_user
            - name: APP_DB_PASSWORD
              value: dev_secret
            - name: SPRING_PROFILES_ACTIVE
              value: container-dev
          # ğŸ§ª Optional: Readiness-Probe fÃ¼r spÃ¤ter
          # readinessProbe:
          #   httpGet:
          #     path: /actuator/health
          #     port: 8080
          #   initialDelaySeconds: 10
          #   periodSeconds: 5
